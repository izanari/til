# Kinesis
## Kinesis Strreams
- ストリームデータを処理するためのアプリケーションを独自に構築
### 主要コンセプト
- ストリームは1つ以上のシャードで構成
- 保存されるデータの単位をデータレコードと予備、保持期間はデフォルトで24時間、最長で7日間
- 1レコードの最大サイズは1MB
- データ送信側のキャパシティは1シャードあたり秒間1MBもしくは1,000PUTレコード
- データ処理側のキャパシティは1シャードあたり秒間2MBもしくは5回のトランザクション
- ストリーム内のシャードを増減させることでスループットをコントロールする
- データレコードの分散
  - データ入力時に指定するパーテションキー（最長256文字）で保存先シャードが決定される
  - MD5ハッシュ関数でパーテションキーを128ビット整数値のハッシュキーに変換
  - ハッシュキーの範囲に対応したシャードにデータレコードをマップ
- データレコードの順序性
  - 全てのデータレコードにはシーケンス番号がアサインされる
  - ストリーム内のシャード毎にユニーク
  - シャード内で時間の経過とともに単調増加
  - データ処理時にシーケンス番号でレコード取得開始ポジションを指定可能
- プロデューサーとコンシューマー
  - プロデューサー（データ送信側）
    - AWS SDK
    - Kinesis Producer Library
    - AWS IOT
    - Kinesis Log4j Appender
    - Fluentd
    - CloudWatch Events/Logs
  - コンシューマー（データ処理側）
    - Kinesis Firehose
    - Get* API
    - Kinesis Client Library
    - Kinesis Analytics
    - Lambda
    - Amazon EMR
    - Apache Storm
## Kinesis Firehose
- ストリームデータをS3,Redshift,ESへ簡単に配信
## Kinesis Analytics
- ストリームデータを標準的なSQLクエリでリアルタイム分析

## 実装時の注意点
- PutRecord APIアクションを呼び出すだけでは不十分です。データを大量に処理をすると、`ProvisionedThroughputExceededException`で弾かれる可能性がある。
  - AWS SDK は効果的なフロー制御を行うために、エクスポネンシャルバックオフアルゴリズムを実装します。エクスポネンシャルバックオフは、再試行間の待機時間を累進的に長くして、連続的なエラー応答を受信するという考えに基づいています。最大遅延間隔で最大回数の再試行を実行する必要があります。再試行の最大遅延間隔と最大回数は必ずしも固定値ではなく、実行する操作や局所的な要因 (ネットワークのレイテンシーなど) に基づいて設定する必要があります。